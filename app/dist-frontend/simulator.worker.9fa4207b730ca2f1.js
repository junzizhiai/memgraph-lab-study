(()=>{"use strict";function I(i){return function(){return i}}function P(i){return 1e-6*(i()-.5)}function xt(i){return i.index}function rt(i,t){var e=i.get(t);if(!e)throw new Error("node not found: "+t);return e}var vt={value:()=>{}};function at(){for(var n,i=0,t=arguments.length,e={};i<t;++i){if(!(n=arguments[i]+"")||n in e||/[\s.]/.test(n))throw new Error("illegal type: "+n);e[n]=[]}return new H(e)}function H(i){this._=i}function Nt(i,t){for(var s,e=0,n=i.length;e<n;++e)if((s=i[e]).name===t)return s.value}function ot(i,t,e){for(var n=0,s=i.length;n<s;++n)if(i[n].name===t){i[n]=vt,i=i.slice(0,n).concat(i.slice(n+1));break}return null!=e&&i.push({name:t,value:e}),i}H.prototype=at.prototype={constructor:H,on:function(i,t){var s,e=this._,n=function mt(i,t){return i.trim().split(/^|\s+/).map(function(e){var n="",s=e.indexOf(".");if(s>=0&&(n=e.slice(s+1),e=e.slice(0,s)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}})}(i+"",e),r=-1,o=n.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++r<o;)if(s=(i=n[r]).type)e[s]=ot(e[s],i.name,t);else if(null==t)for(s in e)e[s]=ot(e[s],i.name,null);return this}for(;++r<o;)if((s=(i=n[r]).type)&&(s=Nt(e[s],i.name)))return s},copy:function(){var i={},t=this._;for(var e in t)i[e]=t[e].slice();return new H(i)},call:function(i,t){if((s=arguments.length-2)>0)for(var s,r,e=new Array(s),n=0;n<s;++n)e[n]=arguments[n+2];if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(n=0,s=(r=this._[i]).length;n<s;++n)r[n].value.apply(t,e)},apply:function(i,t,e){if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(var n=this._[i],s=0,r=n.length;s<r;++s)n[s].value.apply(t,e)}};const St=at;var Q,K,F=0,Y=0,X=0,lt=1e3,J=0,z=0,V=0,j="object"==typeof performance&&performance.now?performance:Date,ht="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(i){setTimeout(i,17)};function ft(){return z||(ht(wt),z=j.now()+V)}function wt(){z=0}function q(){this._call=this._time=this._next=null}function ut(i,t,e){var n=new q;return n.restart(i,t,e),n}function ct(){z=(J=j.now())+V,F=Y=0;try{!function Dt(){ft(),++F;for(var t,i=Q;i;)(t=z-i._time)>=0&&i._call.call(void 0,t),i=i._next;--F}()}finally{F=0,function At(){for(var i,e,t=Q,n=1/0;t;)t._call?(n>t._time&&(n=t._time),i=t,t=t._next):(e=t._next,t._next=null,t=i?i._next=e:Q=e);K=i,W(n)}(),z=0}}function It(){var i=j.now(),t=i-J;t>lt&&(V-=t,J=i)}function W(i){F||(Y&&(Y=clearTimeout(Y)),i-z>24?(i<1/0&&(Y=setTimeout(ct,i-j.now()-V)),X&&(X=clearInterval(X))):(X||(J=j.now(),X=setInterval(It,lt)),F=1,ht(ct)))}q.prototype=ut.prototype={constructor:q,restart:function(i,t,e){if("function"!=typeof i)throw new TypeError("callback is not a function");e=(null==e?ft():+e)+(null==t?0:+t),!this._next&&K!==this&&(K?K._next=this:Q=this,K=this),this._call=i,this._time=e,W()},stop:function(){this._call&&(this._call=null,this._time=1/0,W())}};const gt=4294967296;function Et(i){return i.x}function bt(i){return i.y}var Lt=Math.PI*(3-Math.sqrt(5));function dt(i,t,e,n){if(isNaN(t)||isNaN(e))return i;var s,v,x,c,p,f,h,g,_,r=i._root,o={data:n},a=i._x0,u=i._y0,l=i._x1,d=i._y1;if(!r)return i._root=o,i;for(;r.length;)if((f=t>=(v=(a+l)/2))?a=v:l=v,(h=e>=(x=(u+d)/2))?u=x:d=x,s=r,!(r=r[g=h<<1|f]))return s[g]=o,i;if(c=+i._x.call(null,r.data),p=+i._y.call(null,r.data),t===c&&e===p)return o.next=r,s?s[g]=o:i._root=o,i;do{s=s?s[g]=new Array(4):i._root=new Array(4),(f=t>=(v=(a+l)/2))?a=v:l=v,(h=e>=(x=(u+d)/2))?u=x:d=x}while((g=h<<1|f)==(_=(p>=x)<<1|c>=v));return s[_]=r,s[g]=o,i}function A(i,t,e,n,s){this.node=i,this.x0=t,this.y0=e,this.x1=n,this.y1=s}function Qt(i){return i[0]}function Vt(i){return i[1]}function tt(i,t,e){var n=new it(t??Qt,e??Vt,NaN,NaN,NaN,NaN);return null==i?n:n.addAll(i)}function it(i,t,e,n,s,r){this._x=i,this._y=t,this._x0=e,this._y0=n,this._x1=s,this._y1=r,this._root=void 0}function _t(i){for(var t={data:i.data},e=t;i=i.next;)e=e.next={data:i.data};return t}var M=tt.prototype=it.prototype;function $t(i){return i.x+i.vx}function qt(i){return i.y+i.vy}M.copy=function(){var e,n,i=new it(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root;if(!t)return i;if(!t.length)return i._root=_t(t),i;for(e=[{source:t,target:i._root=new Array(4)}];t=e.pop();)for(var s=0;s<4;++s)(n=t.source[s])&&(n.length?e.push({source:n,target:t.target[s]=new Array(4)}):t.target[s]=_t(n));return i},M.add=function Bt(i){const t=+this._x.call(null,i),e=+this._y.call(null,i);return dt(this.cover(t,e),t,e,i)},M.addAll=function Rt(i){var t,e,s,r,n=i.length,o=new Array(n),a=new Array(n),u=1/0,l=1/0,d=-1/0,v=-1/0;for(e=0;e<n;++e)isNaN(s=+this._x.call(null,t=i[e]))||isNaN(r=+this._y.call(null,t))||(o[e]=s,a[e]=r,s<u&&(u=s),s>d&&(d=s),r<l&&(l=r),r>v&&(v=r));if(u>d||l>v)return this;for(this.cover(u,l).cover(d,v),e=0;e<n;++e)dt(this,o[e],a[e],i[e]);return this},M.cover=function zt(i,t){if(isNaN(i=+i)||isNaN(t=+t))return this;var e=this._x0,n=this._y0,s=this._x1,r=this._y1;if(isNaN(e))s=(e=Math.floor(i))+1,r=(n=Math.floor(t))+1;else{for(var u,l,o=s-e||1,a=this._root;e>i||i>=s||n>t||t>=r;)switch(l=(t<n)<<1|i<e,u=new Array(4),u[l]=a,a=u,o*=2,l){case 0:s=e+o,r=n+o;break;case 1:e=s-o,r=n+o;break;case 2:s=e+o,n=r-o;break;case 3:e=s-o,n=r-o}this._root&&this._root.length&&(this._root=a)}return this._x0=e,this._y0=n,this._x1=s,this._y1=r,this},M.data=function kt(){var i=[];return this.visit(function(t){if(!t.length)do{i.push(t.data)}while(t=t.next)}),i},M.extent=function Ft(i){return arguments.length?this.cover(+i[0][0],+i[0][1]).cover(+i[1][0],+i[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},M.find=function Gt(i,t,e){var n,o,a,u,l,p,f,s=this._x0,r=this._y0,d=this._x1,v=this._y1,x=[],c=this._root;for(c&&x.push(new A(c,s,r,d,v)),null==e?e=1/0:(s=i-e,r=t-e,d=i+e,v=t+e,e*=e);p=x.pop();)if(!(!(c=p.node)||(o=p.x0)>d||(a=p.y0)>v||(u=p.x1)<s||(l=p.y1)<r))if(c.length){var h=(o+u)/2,g=(a+l)/2;x.push(new A(c[3],h,g,u,l),new A(c[2],o,g,h,l),new A(c[1],h,a,u,g),new A(c[0],o,a,h,g)),(f=(t>=g)<<1|i>=h)&&(p=x[x.length-1],x[x.length-1]=x[x.length-1-f],x[x.length-1-f]=p)}else{var _=i-+this._x.call(null,c.data),m=t-+this._y.call(null,c.data),y=_*_+m*m;if(y<e){var N=Math.sqrt(e=y);s=i-N,r=t-N,d=i+N,v=t+N,n=c.data}}return n},M.remove=function Ct(i){if(isNaN(d=+this._x.call(null,i))||isNaN(v=+this._y.call(null,i)))return this;var t,n,s,r,d,v,x,c,p,f,h,g,e=this._root,o=this._x0,a=this._y0,u=this._x1,l=this._y1;if(!e)return this;if(e.length)for(;;){if((p=d>=(x=(o+u)/2))?o=x:u=x,(f=v>=(c=(a+l)/2))?a=c:l=c,t=e,!(e=e[h=f<<1|p]))return this;if(!e.length)break;(t[h+1&3]||t[h+2&3]||t[h+3&3])&&(n=t,g=h)}for(;e.data!==i;)if(s=e,!(e=e.next))return this;return(r=e.next)&&delete e.next,s?(r?s.next=r:delete s.next,this):t?(r?t[h]=r:delete t[h],(e=t[0]||t[1]||t[2]||t[3])&&e===(t[3]||t[2]||t[1]||t[0])&&!e.length&&(n?n[g]=e:this._root=e),this):(this._root=r,this)},M.removeAll=function Yt(i){for(var t=0,e=i.length;t<e;++t)this.remove(i[t]);return this},M.root=function Xt(){return this._root},M.size=function Kt(){var i=0;return this.visit(function(t){if(!t.length)do{++i}while(t=t.next)}),i},M.visit=function jt(i){var e,s,r,o,a,u,t=[],n=this._root;for(n&&t.push(new A(n,this._x0,this._y0,this._x1,this._y1));e=t.pop();)if(!i(n=e.node,r=e.x0,o=e.y0,a=e.x1,u=e.y1)&&n.length){var l=(r+a)/2,d=(o+u)/2;(s=n[3])&&t.push(new A(s,l,d,a,u)),(s=n[2])&&t.push(new A(s,r,d,l,u)),(s=n[1])&&t.push(new A(s,l,o,a,d)),(s=n[0])&&t.push(new A(s,r,o,l,d))}return this},M.visitAfter=function Ht(i){var n,t=[],e=[];for(this._root&&t.push(new A(this._root,this._x0,this._y0,this._x1,this._y1));n=t.pop();){var s=n.node;if(s.length){var r,o=n.x0,a=n.y0,u=n.x1,l=n.y1,d=(o+u)/2,v=(a+l)/2;(r=s[0])&&t.push(new A(r,o,a,d,v)),(r=s[1])&&t.push(new A(r,d,a,u,v)),(r=s[2])&&t.push(new A(r,o,v,d,l)),(r=s[3])&&t.push(new A(r,d,v,u,l))}e.push(n)}for(;n=e.pop();)i(n.node,n.x0,n.y0,n.x1,n.y1);return this},M.x=function Jt(i){return arguments.length?(this._x=i,this):this._x},M.y=function Zt(i){return arguments.length?(this._y=i,this):this._y};class si{constructor(){this._listeners=new Map}once(t,e){const n={callable:e,isOnce:!0},s=this._listeners.get(t);return s?s.push(n):this._listeners.set(t,[n]),this}on(t,e){const n={callable:e},s=this._listeners.get(t);return s?s.push(n):this._listeners.set(t,[n]),this}off(t,e){const n=this._listeners.get(t);if(n){const s=n.filter(r=>r.callable!==e);this._listeners.set(t,s)}return this}emit(t,e){const n=this._listeners.get(t);if(!n||0===n.length)return!1;let s=!1;for(let r=0;r<n.length;r++)n[r].isOnce&&(s=!0),n[r].callable(e);if(s){const r=n.filter(o=>!o.isOnce);this._listeners.set(t,r)}return!0}eventNames(){return[...this._listeners.keys()]}listenerCount(t){const e=this._listeners.get(t);return e?e.length:0}listeners(t){const e=this._listeners.get(t);return e?e.map(n=>n.callable):[]}addListener(t,e){return this.on(t,e)}removeListener(t,e){return this.off(t,e)}removeAllListeners(t){return t?this._listeners.delete(t):this._listeners.clear(),this}}const et=i=>i instanceof Date,Z=i=>Array.isArray(i),nt=i=>null!==i&&"object"==typeof i&&"Object"===i.constructor.name,G=i=>et(i)?ai(i):Z(i)?oi(i):nt(i)?li(i):i,$=(i,t)=>{const e=et(i),n=et(t);if(e&&!n||!e&&n)return!1;if(e&&n)return i.getTime()===t.getTime();const s=Z(i),r=Z(t);if(s&&!r||!s&&r)return!1;if(s&&r)return i.length===t.length&&i.every((u,l)=>$(u,t[l]));const o=nt(i),a=nt(t);if(o&&!a||!o&&a)return!1;if(o&&a){const u=Object.keys(i),l=Object.keys(t);return!!$(u,l)&&u.every(d=>$(i[d],t[d]))}return i===t},ai=i=>new Date(i),oi=i=>i.map(t=>G(t)),li=i=>{const t={};return Object.keys(i).forEach(e=>{t[e]=G(i[e])}),t};var E=function(i){return i.SIMULATION_START="simulation-start",i.SIMULATION_PROGRESS="simulation-progress",i.SIMULATION_END="simulation-end",i.SIMULATION_TICK="simulation-tick",i.NODE_DRAG="node-drag",i.SETTINGS_UPDATE="settings-update",i}(E||{});const st={isSimulatingOnDataUpdate:!0,isSimulatingOnSettingsUpdate:!0,isSimulatingOnUnstick:!0,isPhysicsEnabled:!1,alpha:{alpha:1,alphaMin:.001,alphaDecay:.0228,alphaTarget:0},centering:{x:0,y:0,strength:1},collision:{radius:15,strength:1,iterations:1},links:{distance:30,strength:void 0,iterations:1},manyBody:{strength:-100,theta:.9,distanceMin:0,distanceMax:3e3},positioning:{forceX:{x:0,strength:.1},forceY:{y:0,strength:.1}}};var O=function(i){return i.SetupData="Set Data",i.MergeData="Add Data",i.UpdateData="Update Data",i.DeleteData="Delete Data",i.ClearData="Clear Data",i.Simulate="Simulate",i.ActivateSimulation="Activate Simulation",i.StartSimulation="Start Simulation",i.UpdateSimulation="Update Simulation",i.StopSimulation="Stop Simulation",i.StartDragNode="Start Drag Node",i.DragNode="Drag Node",i.EndDragNode="End Drag Node",i.FixNodes="Fix Nodes",i.ReleaseNodes="Release Nodes",i.SetSettings="Set Settings",i}(O||{}),k=function(i){return i.SIMULATION_START="simulation-start",i.SIMULATION_STEP="simulation-step",i.SIMULATION_PROGRESS="simulation-progress",i.SIMULATION_END="simulation-end",i.SIMULATION_TICK="simulation-tick",i.NODE_DRAG="node-drag",i.NODE_DRAG_END="node-drag-end",i.SETTINGS_UPDATE="settings-update",i}(k||{});const S=new class fi extends si{constructor(t){super(),this._edges=[],this._nodes=[],this._nodeIndexByNodeId={},this._isDragging=!1,this._isStabilizing=!1,void 0!==t&&(this._initialSettings=Object.assign(G(st),t)),this.settings=this.resetSettings(),this.clearData()}getSettings(){return G(this.settings)}setSettings(t){this._initialSettings||(this._initialSettings=Object.assign(G(st),t));const e=this.getSettings();Object.assign(this.settings,t),$(this.settings,e)||(this._initSimulation(t),this.emit(E.SETTINGS_UPDATE,{settings:this.settings}),e.isPhysicsEnabled&&!t.isPhysicsEnabled?this.simulation.stop():this.settings.isSimulatingOnSettingsUpdate&&this.activateSimulation())}resetSettings(){return Object.assign(G(st),this._initialSettings)}startDragNode(){this._isDragging=!0,!this._isStabilizing&&this.settings.isPhysicsEnabled&&this.activateSimulation()}dragNode(t){const e=this._nodes[this._nodeIndexByNodeId[t.id]];e&&(this._isDragging||this.startDragNode(),e.fx=t.x,e.fy=t.y,this.settings.isPhysicsEnabled||(e.x=t.x,e.y=t.y),this.emit(E.NODE_DRAG,{nodes:this._nodes,edges:this._edges}))}endDragNode(t){this._isDragging=!1,this.settings.isPhysicsEnabled&&this.simulation.alphaTarget(0);const e=this._nodes[this._nodeIndexByNodeId[t.id]];e&&this.settings.isPhysicsEnabled&&this.unfixNode(e)}activateSimulation(){this.unfixNodes(),this.simulation.alpha(this.settings.alpha.alpha).alphaTarget(this.settings.alpha.alphaTarget).restart()}setupData(t){this.clearData(),this._initializeNewData(t),this.settings.isSimulatingOnDataUpdate&&(this._updateSimulationData(),this._runSimulation())}mergeData(t){this._initializeNewData(t),this.settings.isSimulatingOnDataUpdate&&(this._updateSimulationData(),this.activateSimulation())}_initializeNewData(t){if(t.nodes){t.nodes=this._fixDefinedNodes(t.nodes);for(let e=0;e<t.nodes.length;e+=1)this._nodeIndexByNodeId[t.nodes[e].id]?this._nodeIndexByNodeId=Object.assign(Object.assign({},this._nodeIndexByNodeId),t.nodes[e]):this._nodes.push(t.nodes[e])}else this._nodes=[];this._edges=t.edges?this._edges.concat(t.edges):[],this._setNodeIndexByNodeId()}updateData(t){t.nodes=this._fixDefinedNodes(t.nodes);const e=new Set(t.nodes.map(r=>r.id)),n=this._nodes.filter(r=>e.has(r.id)),s=t.nodes.filter(r=>void 0===this._nodeIndexByNodeId[r.id]);this._nodes=[...n,...s],this._setNodeIndexByNodeId(),this._edges=t.edges,this.settings.isSimulatingOnSettingsUpdate&&(this._updateSimulationData(),this.activateSimulation())}deleteData(t){const e=new Set(t.nodeIds);this._nodes=this._nodes.filter(s=>!e.has(s.id));const n=new Set(t.edgeIds);this._edges=this._edges.filter(s=>!n.has(s.id)),this._setNodeIndexByNodeId(),this._updateSimulationData()}clearData(){this._nodes=[],this._edges=[],this._setNodeIndexByNodeId(),this.resetSimulation()}_updateSimulationData(){this.simulation.nodes(this._nodes),this.linkForce.links(this._edges)}startSimulation(){}stopSimulation(){this.simulation.stop(),this._nodes=[],this._edges=[],this._setNodeIndexByNodeId(),this._updateSimulationData()}resetSimulation(){this.linkForce=function pt(i){var n,r,o,a,u,l,t=xt,e=function v(h){return 1/Math.min(a[h.source.index],a[h.target.index])},s=I(30),d=1;function x(h){for(var g=0,_=i.length;g<d;++g)for(var y,N,T,b,w,U,D,m=0;m<_;++m)b=(T=(y=i[m]).target).x+T.vx-(N=y.source).x-N.vx||P(l),w=T.y+T.vy-N.y-N.vy||P(l),w*=U=((U=Math.sqrt(b*b+w*w))-r[m])/U*h*n[m],T.vx-=(b*=U)*(D=u[m]),T.vy-=w*D,N.vx+=b*(D=1-D),N.vy+=w*D}function c(){if(o){var h,y,g=o.length,_=i.length,m=new Map(o.map((N,T)=>[t(N,T,o),N]));for(h=0,a=new Array(g);h<_;++h)(y=i[h]).index=h,"object"!=typeof y.source&&(y.source=rt(m,y.source)),"object"!=typeof y.target&&(y.target=rt(m,y.target)),a[y.source.index]=(a[y.source.index]||0)+1,a[y.target.index]=(a[y.target.index]||0)+1;for(h=0,u=new Array(_);h<_;++h)u[h]=a[(y=i[h]).source.index]/(a[y.source.index]+a[y.target.index]);n=new Array(_),p(),r=new Array(_),f()}}function p(){if(o)for(var h=0,g=i.length;h<g;++h)n[h]=+e(i[h],h,i)}function f(){if(o)for(var h=0,g=i.length;h<g;++h)r[h]=+s(i[h],h,i)}return null==i&&(i=[]),x.initialize=function(h,g){o=h,l=g,c()},x.links=function(h){return arguments.length?(i=h,c(),x):i},x.id=function(h){return arguments.length?(t=h,x):t},x.iterations=function(h){return arguments.length?(d=+h,x):d},x.strength=function(h){return arguments.length?(e="function"==typeof h?h:I(+h),p(),x):e},x.distance=function(h){return arguments.length?(s="function"==typeof h?h:I(+h),f(),x):s},x}(this._edges).id(t=>t.id),this.simulation=function Pt(i){var t,e=1,n=.001,s=1-Math.pow(n,1/300),r=0,o=.6,a=new Map,u=ut(v),l=St("tick","end"),d=function Tt(){let i=1;return()=>(i=(1664525*i+1013904223)%gt)/gt}();function v(){x(),l.call("tick",t),e<n&&(u.stop(),l.call("end",t))}function x(f){var h,_,g=i.length;void 0===f&&(f=1);for(var m=0;m<f;++m)for(e+=(r-e)*s,a.forEach(function(y){y(e)}),h=0;h<g;++h)null==(_=i[h]).fx?_.x+=_.vx*=o:(_.x=_.fx,_.vx=0),null==_.fy?_.y+=_.vy*=o:(_.y=_.fy,_.vy=0);return t}function c(){for(var g,f=0,h=i.length;f<h;++f){if((g=i[f]).index=f,null!=g.fx&&(g.x=g.fx),null!=g.fy&&(g.y=g.fy),isNaN(g.x)||isNaN(g.y)){var _=10*Math.sqrt(.5+f),m=f*Lt;g.x=_*Math.cos(m),g.y=_*Math.sin(m)}(isNaN(g.vx)||isNaN(g.vy))&&(g.vx=g.vy=0)}}function p(f){return f.initialize&&f.initialize(i,d),f}return null==i&&(i=[]),c(),t={tick:x,restart:function(){return u.restart(v),t},stop:function(){return u.stop(),t},nodes:function(f){return arguments.length?(i=f,c(),a.forEach(p),t):i},alpha:function(f){return arguments.length?(e=+f,t):e},alphaMin:function(f){return arguments.length?(n=+f,t):n},alphaDecay:function(f){return arguments.length?(s=+f,t):+s},alphaTarget:function(f){return arguments.length?(r=+f,t):r},velocityDecay:function(f){return arguments.length?(o=1-f,t):1-o},randomSource:function(f){return arguments.length?(d=f,a.forEach(p),t):d},force:function(f,h){return arguments.length>1?(null==h?a.delete(f):a.set(f,p(h)),t):a.get(f)},find:function(f,h,g){var y,N,T,b,w,_=0,m=i.length;for(null==g?g=1/0:g*=g,_=0;_<m;++_)(T=(y=f-(b=i[_]).x)*y+(N=h-b.y)*N)<g&&(w=b,g=T);return w},on:function(f,h){return arguments.length>1?(l.on(f,h),t):l.on(f)}}}(this._nodes).force("link",this.linkForce).stop(),this._initSimulation(this.settings),this.simulation.on("tick",()=>{this.emit(E.SIMULATION_TICK,{nodes:this._nodes,edges:this._edges})}),this.simulation.on("end",()=>{this._isDragging=!1,this._isStabilizing=!1,this.emit(E.SIMULATION_END,{nodes:this._nodes,edges:this._edges}),this.settings.isPhysicsEnabled||this.fixNodes()})}fixNodes(t){t||(t=this._nodes);for(let e=0;e<t.length;e++)this.fixNode(this._nodes[e])}unfixNodes(t){t||(t=this._nodes);for(let e=0;e<t.length;e++)this.unfixNode(this._nodes[e])}fixNode(t){null==t.sx&&(t.fx=t.x),null==t.sy&&(t.fy=t.y)}unfixNode(t){null==t.sx&&(t.fx=null),null==t.sy&&(t.fy=null)}stickNodes(t){t||(t=this._nodes);for(let e=0;e<t.length;e++)this.stickNode(this._nodes[e])}unstickNodes(t){t||(t=this._nodes);for(let e=0;e<t.length;e++)this.unstickNode(this._nodes[e]);this.settings.isSimulatingOnUnstick&&this.activateSimulation()}stickNode(t){t.sx=t.x,t.fx=t.x,t.sy=t.y,t.fy=t.y}unstickNode(t){t.sx=null,t.sy=null,this.settings.isPhysicsEnabled&&(t.fx=null,t.fy=null)}_fixDefinedNodes(t){for(let e=0;e<t.length;e++)null!=t[e].x&&(t[e].fx=t[e].x,t[e].sx=t[e].x),null!=t[e].y&&(t[e].fy=t[e].y,t[e].sy=t[e].y);return t}_initSimulation(t){var e,n,s,r;if(t.alpha&&this.simulation.alpha(t.alpha.alpha).alphaMin(t.alpha.alphaMin).alphaDecay(t.alpha.alphaDecay).alphaTarget(t.alpha.alphaTarget),t.links&&this.linkForce.distance(t.links.distance).iterations(t.links.iterations),t.collision){const o=function Wt(i){var t,e,n,s=1,r=1;function o(){for(var l,v,x,c,p,f,h,d=t.length,g=0;g<r;++g)for(v=tt(t,$t,qt).visitAfter(a),l=0;l<d;++l)h=(f=e[(x=t[l]).index])*f,c=x.x+x.vx,p=x.y+x.vy,v.visit(_);function _(m,y,N,T,b){var w=m.data,U=m.r,D=f+U;if(!w)return y>c+D||T<c-D||N>p+D||b<p-D;if(w.index>x.index){var B=c-w.x-w.vx,R=p-w.y-w.vy,L=B*B+R*R;L<D*D&&(0===B&&(L+=(B=P(n))*B),0===R&&(L+=(R=P(n))*R),L=(D-(L=Math.sqrt(L)))/L*s,x.vx+=(B*=L)*(D=(U*=U)/(h+U)),x.vy+=(R*=L)*D,w.vx-=B*(D=1-D),w.vy-=R*D)}}}function a(l){if(l.data)return l.r=e[l.data.index];for(var d=l.r=0;d<4;++d)l[d]&&l[d].r>l.r&&(l.r=l[d].r)}function u(){if(t){var l,v,d=t.length;for(e=new Array(d),l=0;l<d;++l)e[(v=t[l]).index]=+i(v,l,t)}}return"function"!=typeof i&&(i=I(null==i?1:+i)),o.initialize=function(l,d){t=l,n=d,u()},o.iterations=function(l){return arguments.length?(r=+l,o):r},o.strength=function(l){return arguments.length?(s=+l,o):s},o.radius=function(l){return arguments.length?(i="function"==typeof l?l:I(+l),u(),o):i},o}().radius(t.collision.radius).strength(t.collision.strength).iterations(t.collision.iterations);this.simulation.force("collide",o)}if(null===t.collision&&this.simulation.force("collide",null),t.manyBody){const o=function ti(){var i,t,e,n,r,s=I(-30),o=1,a=1/0,u=.81;function l(c){var p,f=i.length,h=tt(i,Et,bt).visitAfter(v);for(n=c,p=0;p<f;++p)t=i[p],h.visit(x)}function d(){if(i){var c,f,p=i.length;for(r=new Array(p),c=0;c<p;++c)r[(f=i[c]).index]=+s(f,c,i)}}function v(c){var f,h,_,m,y,p=0,g=0;if(c.length){for(_=m=y=0;y<4;++y)(f=c[y])&&(h=Math.abs(f.value))&&(p+=f.value,g+=h,_+=h*f.x,m+=h*f.y);c.x=_/g,c.y=m/g}else{(f=c).x=f.data.x,f.y=f.data.y;do{p+=r[f.data.index]}while(f=f.next)}c.value=p}function x(c,p,f,h){if(!c.value)return!0;var g=c.x-t.x,_=c.y-t.y,m=h-p,y=g*g+_*_;if(m*m/u<y)return y<a&&(0===g&&(y+=(g=P(e))*g),0===_&&(y+=(_=P(e))*_),y<o&&(y=Math.sqrt(o*y)),t.vx+=g*c.value*n/y,t.vy+=_*c.value*n/y),!0;if(!(c.length||y>=a)){(c.data!==t||c.next)&&(0===g&&(y+=(g=P(e))*g),0===_&&(y+=(_=P(e))*_),y<o&&(y=Math.sqrt(o*y)));do{c.data!==t&&(t.vx+=g*(m=r[c.data.index]*n/y),t.vy+=_*m)}while(c=c.next)}}return l.initialize=function(c,p){i=c,e=p,d()},l.strength=function(c){return arguments.length?(s="function"==typeof c?c:I(+c),d(),l):s},l.distanceMin=function(c){return arguments.length?(o=c*c,l):Math.sqrt(o)},l.distanceMax=function(c){return arguments.length?(a=c*c,l):Math.sqrt(a)},l.theta=function(c){return arguments.length?(u=c*c,l):Math.sqrt(u)},l}().strength(t.manyBody.strength).theta(t.manyBody.theta).distanceMin(t.manyBody.distanceMin).distanceMax(t.manyBody.distanceMax);this.simulation.force("charge",o)}if(null===t.manyBody&&this.simulation.force("charge",null),null!==(e=t.positioning)&&void 0!==e&&e.forceY){const o=function ii(i){var e,n,s,t=I(.1);function r(a){for(var d,u=0,l=e.length;u<l;++u)(d=e[u]).vx+=(s[u]-d.x)*n[u]*a}function o(){if(e){var a,u=e.length;for(n=new Array(u),s=new Array(u),a=0;a<u;++a)n[a]=isNaN(s[a]=+i(e[a],a,e))?0:+t(e[a],a,e)}}return"function"!=typeof i&&(i=I(null==i?0:+i)),r.initialize=function(a){e=a,o()},r.strength=function(a){return arguments.length?(t="function"==typeof a?a:I(+a),o(),r):t},r.x=function(a){return arguments.length?(i="function"==typeof a?a:I(+a),o(),r):i},r}(t.positioning.forceX.x).strength(t.positioning.forceX.strength);this.simulation.force("x",o)}if(null===(null===(n=t.positioning)||void 0===n?void 0:n.forceX)&&this.simulation.force("x",null),null!==(s=t.positioning)&&void 0!==s&&s.forceY){const o=function ei(i){var e,n,s,t=I(.1);function r(a){for(var d,u=0,l=e.length;u<l;++u)(d=e[u]).vy+=(s[u]-d.y)*n[u]*a}function o(){if(e){var a,u=e.length;for(n=new Array(u),s=new Array(u),a=0;a<u;++a)n[a]=isNaN(s[a]=+i(e[a],a,e))?0:+t(e[a],a,e)}}return"function"!=typeof i&&(i=I(null==i?0:+i)),r.initialize=function(a){e=a,o()},r.strength=function(a){return arguments.length?(t="function"==typeof a?a:I(+a),o(),r):t},r.y=function(a){return arguments.length?(i="function"==typeof a?a:I(+a),o(),r):i},r}(t.positioning.forceY.y).strength(t.positioning.forceY.strength);this.simulation.force("y",o)}if(null===(null===(r=t.positioning)||void 0===r?void 0:r.forceY)&&this.simulation.force("y",null),t.centering){const o=function ni(i,t){var e,n=1;function s(){var r,a,o=e.length,u=0,l=0;for(r=0;r<o;++r)u+=(a=e[r]).x,l+=a.y;for(u=(u/o-i)*n,l=(l/o-t)*n,r=0;r<o;++r)(a=e[r]).x-=u,a.y-=l}return null==i&&(i=0),null==t&&(t=0),s.initialize=function(r){e=r},s.x=function(r){return arguments.length?(i=+r,s):i},s.y=function(r){return arguments.length?(t=+r,s):t},s.strength=function(r){return arguments.length?(n=+r,s):n},s}(t.centering.x,t.centering.y).strength(t.centering.strength);this.simulation.force("center",o)}null===t.centering&&this.simulation.force("center",null)}_runSimulation(t){if(this._isStabilizing)return;(this.settings.isPhysicsEnabled||t?.isUpdatingSettings)&&this.unfixNodes(),this.emit(E.SIMULATION_START,void 0),this._isStabilizing=!0,this.simulation.alpha(this.settings.alpha.alpha).alphaTarget(this.settings.alpha.alphaTarget).stop();const e=Math.ceil(Math.log(this.settings.alpha.alphaMin)/Math.log(1-this.settings.alpha.alphaDecay));let n=-1;for(let s=0;s<e;s++){const r=Math.round(100*s/e);r>n&&(n=r,this.emit(E.SIMULATION_PROGRESS,{nodes:this._nodes,edges:this._edges,progress:r/100})),this.simulation.tick()}this.settings.isPhysicsEnabled||this.fixNodes(),this._isStabilizing=!1,this.emit(E.SIMULATION_END,{nodes:this._nodes,edges:this._edges})}_setNodeIndexByNodeId(){this._nodeIndexByNodeId={};for(let t=0;t<this._nodes.length;t++)this._nodeIndexByNodeId[this._nodes[t].id]=t}},C=i=>{postMessage(i)};S.on(E.SIMULATION_START,()=>{C({type:k.SIMULATION_START})}),S.on(E.SIMULATION_PROGRESS,i=>{C({type:k.SIMULATION_PROGRESS,data:i})}),S.on(E.SIMULATION_END,i=>{C({type:k.SIMULATION_END,data:i})}),S.on(E.NODE_DRAG,i=>{C({type:k.NODE_DRAG,data:i})}),S.on(E.SIMULATION_TICK,i=>{C({type:k.SIMULATION_STEP,data:i})}),S.on(E.SETTINGS_UPDATE,i=>{C({type:k.SETTINGS_UPDATE,data:i})}),addEventListener("message",({data:i})=>{switch(i.type){case O.ActivateSimulation:S.activateSimulation();break;case O.SetupData:S.setupData(i.data);break;case O.MergeData:S.mergeData(i.data);break;case O.UpdateData:S.updateData(i.data);break;case O.DeleteData:S.deleteData(i.data);break;case O.ClearData:S.clearData();break;case O.StartSimulation:S.startSimulation();break;case O.StopSimulation:S.stopSimulation();break;case O.StartDragNode:S.startDragNode();break;case O.DragNode:S.dragNode(i.data);break;case O.FixNodes:S.stickNodes(i.data.nodes);break;case O.ReleaseNodes:S.unstickNodes(i.data.nodes);break;case O.EndDragNode:S.endDragNode(i.data);break;case O.SetSettings:S.setSettings(i.data)}})})();